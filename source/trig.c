#include "trig.h"

//Generated with: 
//    for (double i = -1; i <= 1; i+=0.01){ printf("%1.5f, ", acos(i)); }
// (add a 0 at the end)
static double lookup_acos[201] = {
	3.14159, 3.00005, 2.94126, 2.89603, 2.85780, 2.82403, 2.79343, 2.76521, 2.73888, 2.71408, 2.69057, 2.66814, 2.64666, 2.62600, 2.60607, 2.58678, 2.56808, 2.54990, 2.53221, 2.51495, 2.49809, 2.48161, 2.46546, 2.44964, 2.43411, 2.41886, 2.40387, 2.38912, 2.37460, 2.36029, 2.34619, 2.33229, 2.31856, 2.30501, 2.29162, 2.27838, 2.26529, 2.25235, 2.23954, 2.22686, 2.21430, 2.20186, 2.18953, 2.17730, 2.16518, 2.15316, 2.14123, 2.12940, 2.11765, 2.10598, 2.09440, 2.08289, 2.07145, 2.06009, 2.04879, 2.03756, 2.02640, 2.01529, 2.00424, 1.99325, 1.98231, 1.97143, 1.96059, 1.94981, 1.93906, 1.92837, 1.91771, 1.90710, 1.89653, 1.88599, 1.87549, 1.86502, 1.85459, 1.84419, 1.83382, 1.82348, 1.81316, 1.80287, 1.79261, 1.78237, 1.77215, 1.76196, 1.75178, 1.74163, 1.73149, 1.72136, 1.71126, 1.70117, 1.69109, 1.68102, 1.67096, 1.66092, 1.65088, 1.64085, 1.63083, 1.62082, 1.61081, 1.60080, 1.59080, 1.58080, 1.57080, 1.56080, 1.55079, 1.54079, 1.53079, 1.52078, 1.51076, 1.50074, 1.49071, 1.48067, 1.47063, 1.46057, 1.45051, 1.44043, 1.43033, 1.42023, 1.41011, 1.39997, 1.38981, 1.37963, 1.36944, 1.35922, 1.34898, 1.33872, 1.32843, 1.31812, 1.30777, 1.29740, 1.28700, 1.27657, 1.26610, 1.25560, 1.24507, 1.23449, 1.22388, 1.21323, 1.20253, 1.19179, 1.18100, 1.17016, 1.15928, 1.14834, 1.13735, 1.12630, 1.11520, 1.10403, 1.09280, 1.08151, 1.07014, 1.05871, 1.04720, 1.03561, 1.02395, 1.01220, 1.00036, 0.98843, 0.97641, 0.96429, 0.95207, 0.93974, 0.92730, 0.91474, 0.90205, 0.88924, 0.87630, 0.86321, 0.84998, 0.83659, 0.82303, 0.80931, 0.79540, 0.78130, 0.76699, 0.75247, 0.73773, 0.72273, 0.70748, 0.69196, 0.67613, 0.65999, 0.64350, 0.62664, 0.60939, 0.59169, 0.57351, 0.55481, 0.53553, 0.51559, 0.49493, 0.47345, 0.45103, 0.42751, 0.40272, 0.37638, 0.34817, 0.31756, 0.28379, 0.24557, 0.20033, 0.14154, 0.00000
};

//Generated with:
//    for (uint8_t i = 0; i <= 90; i++){ printf("%1.5f, ", cos(i * M_PI / 180)); }
static double lookup_cos[91] = {
	1.00000, 0.99985, 0.99939, 0.99863, 0.99756, 0.99619, 0.99452, 0.99255, 0.99027, 0.98769, 0.98481, 0.98163, 0.97815, 0.97437, 0.97030, 0.96593, 0.96126, 0.95630, 0.95106, 0.94552, 0.93969, 0.93358, 0.92718, 0.92050, 0.91355, 0.90631, 0.89879, 0.89101, 0.88295, 0.87462, 0.86603, 0.85717, 0.84805, 0.83867, 0.82904, 0.81915, 0.80902, 0.79864, 0.78801, 0.77715, 0.76604, 0.75471, 0.74314, 0.73135, 0.71934, 0.70711, 0.69466, 0.68200, 0.66913, 0.65606, 0.64279, 0.62932, 0.61566, 0.60182, 0.58779, 0.57358, 0.55919, 0.54464, 0.52992, 0.51504, 0.50000, 0.48481, 0.46947, 0.45399, 0.43837, 0.42262, 0.40674, 0.39073, 0.37461, 0.35837, 0.34202, 0.32557, 0.30902, 0.29237, 0.27564, 0.25882, 0.24192, 0.22495, 0.20791, 0.19081, 0.17365, 0.15643, 0.13917, 0.12187, 0.10453, 0.08716, 0.06976, 0.05234, 0.03490, 0.01745, 0.00000
};

//Generated with:
//    for (uint8_t i = 0; i <= 90; i++){ printf("%1.5f, ", sin(i * M_PI / 180)); }
static double lookup_sin[91] = {
	0.00000, 0.01745, 0.03490, 0.05234, 0.06976, 0.08716, 0.10453, 0.12187, 0.13917, 0.15643, 0.17365, 0.19081, 0.20791, 0.22495, 0.24192, 0.25882, 0.27564, 0.29237, 0.30902, 0.32557, 0.34202, 0.35837, 0.37461, 0.39073, 0.40674, 0.42262, 0.43837, 0.45399, 0.46947, 0.48481, 0.50000, 0.51504, 0.52992, 0.54464, 0.55919, 0.57358, 0.58779, 0.60182, 0.61566, 0.62932, 0.64279, 0.65606, 0.66913, 0.68200, 0.69466, 0.70711, 0.71934, 0.73135, 0.74314, 0.75471, 0.76604, 0.77715, 0.78801, 0.79864, 0.80902, 0.81915, 0.82904, 0.83867, 0.84805, 0.85717, 0.86603, 0.87462, 0.88295, 0.89101, 0.89879, 0.90631, 0.91355, 0.92050, 0.92718, 0.93358, 0.93969, 0.94552, 0.95106, 0.95630, 0.96126, 0.96593, 0.97030, 0.97437, 0.97815, 0.98163, 0.98481, 0.98769, 0.99027, 0.99255, 0.99452, 0.99619, 0.99756, 0.99863, 0.99939, 0.99985, 1.00000
};

uint8_t constrain_angle(int16_t angle, uint8_t *quadrant){
	//Get the angle into 0..360 degrees
	while (angle < 0){
		angle += 360;
	}
	while (angle >= 360){
		angle -= 360;
	}
	
	if (angle <= 90) {
		*quadrant = 1;
	}
	else if (angle <= 180){
		*quadrant = 2;
		angle = 180 - angle;
	}
	else if (angle <= 270){
		*quadrant = 3;
		angle = angle - 180;
	}
	else {
		*quadrant = 4;
		angle = 360 - angle;
	}

	return angle;
}

double acos_f(double value){
	if (value < -1 || value > 1) return NAN;
	return lookup_acos[(uint8_t) ((value * 100) + 100)];
}

double cos_f(double angle_r){
	uint16_t angle = angle_r * 180 / M_PI;
	uint8_t quadrant = 0;
	angle = constrain_angle(angle, &quadrant);
	return lookup_cos[angle] * (quadrant == 2 || quadrant == 3 ? -1 : 1);
}

double sin_f(double angle_r){
	uint16_t angle = angle_r * 180 / M_PI;
	uint8_t quadrant = 0;
	angle = constrain_angle(angle, &quadrant);
	return lookup_sin[angle] * (quadrant >= 3 ? -1 : 1);
}
/*
int main() {
	for (double i = -1; i <= 1.001; i+=0.001){
		printf("%1.3f, %d, %3.0f, %d\n", i, (uint8_t) ((i * 100) + 100), acos(i) * (180 / M_PI), acos_d(i));
	}
	printf("%1.3f, %d, %3.0f, %d\n", 1.0, (uint8_t) ((1.0 * 100) + 100), acos(1.0) * (180 / M_PI), acos_d(1.0));
}
*/
